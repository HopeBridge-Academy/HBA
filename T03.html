<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <title>Ú¯Ø²Ø§Ø±Ø´ ØªØ¯Ø±ÛŒØ³ - Ø¢Ú©Ø§Ø¯Ù…ÛŒ Ù‡ÙˆÙ¾â€ŒØ¨Ø±ÛŒØ¬</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Naskh+Arabic&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous" />
    <link rel="stylesheet" href="styles.css">

    <style>
        body {
            font-family: 'Noto Naskh Arabic', sans-serif;
            margin: 0;
            padding: 0;
            color: #2d3748;
            animation: fadeInBody 1s ease-in-out;
        }

        @keyframes fadeInBody {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        header {
            background-color: #3b82f6;
            color: white;
            text-align: center;
            padding: 1rem;
            font-size: 1.5rem;
            font-weight: bold;
            animation: slideInHeader 0.5s ease-out;
        }

        @keyframes slideInHeader {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        main {
            max-width: 900px;
            margin: 2rem auto;
            background: rgb(219, 245, 241);
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            animation: fadeInMain 0.8s ease-in-out;
        }

        @keyframes fadeInMain {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        label {
            font-weight: bold;
            margin-top: 1rem;
            display: block;
            color: #2d3748;
        }

        input, textarea, select, button {
            width: 100%;
            padding: 0.6rem;
            margin-top: 0.3rem;
            border: 1px solid #43a330;
            border-radius: 5px;
            font-family: inherit;
            font-size: 1rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 5px rgba(59, 130, 246, 0.5);
            outline: none;
        }

        button {
            background: #3b82f6;
            color: white;
            margin-top: 1.5rem;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }

        button:hover {
            background: #2563eb;
            transform: scale(1.02);
        }

        .delete-report-button, .send-report-button {
            background: #ef4444;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0.3rem 0.6rem;
            font-size: 0.9rem;
            border-radius: 3px;
            margin-right: 0.5rem;
            transition: background-color 0.3s, transform 0.2s;
        }

        .send-report-button {
            background: #10b981;
        }

        .delete-report-button:hover {
            background: #dc2626;
            transform: scale(1.02);
        }

        .send-report-button:hover {
            background: #059669;
            transform: scale(1.02);
        }

        .send-report-button.sent {
            background: #059669;
            cursor: default;
        }

        .send-report-button.sent:hover {
            transform: none;
        }

        .export-button {
            background: #3b82f6;
            color: rgb(255, 255, 255);
            padding: 0.6rem 1rem;
            font-size: 1rem;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            margin-top: 1rem;
            transition: background-color 0.3s, transform 0.2s;
            display: inline-block;
        }

        .export-button:hover {
            background: #2563eb;
            transform: scale(1.02);
        }

        .export-button i {
            margin-left: 0.3rem;
        }

        iframe {
            width: 100%;
            height: 500px;
            margin: 1rem 0;
            border: 1px solid #d1d5db;
            border-radius: 5px;
        }

        .teacher-id {
            font-size: 0.9rem;
            color: #6b7280;
            margin-bottom: 1rem;
        }

        .report-entry {
            background: #c4dbeb;
            padding: 1rem;
            margin-top: 1.5rem;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            animation: scaleInImage 0.5s ease-out;
        }

        @keyframes scaleInImage {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .report-entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .subtitle {
            font-weight: bold;
            color: #3b82f6;
            margin-bottom: 0.5rem;
        }

        .exam-panel {
            margin-top: 2rem;
            background: #d5e6ae;
            padding: 1rem;
            border: 1px solid #acd3a8;
            border-radius: 10px;
            animation: fadeInForm 0.6s ease-in-out;
        }

        @keyframes fadeInForm {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .exam-panel h3 {
            color: #e65100;
            margin-top: 0;
        }

        .exam-entry {
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            background: #fff9f0;
            border: 1px solid #ffe0b2;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .exam-entry span {
            flex-grow: 1;
        }

        .exam-entry button {
            background: #ef4444;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0.3rem 0.6rem;
            font-size: 0.9rem;
            border-radius: 3px;
            margin-left: 1rem;
            transition: background-color 0.3s, transform 0.2s;
        }

        .exam-entry button:hover {
            background: #dc2626;
            transform: scale(1.02);
        }

        .add-exam-form {
            margin-top: 1rem;
            border-top: 1px solid #d1d5db;
            padding-top: 1rem;
        }

        .add-exam-form input {
            width: auto;
            display: inline-block;
            margin-left: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .add-exam-form label {
            display: inline-block;
            width: 90px;
            margin-left: 0.5rem;
        }

        .add-exam-form button {
            width: auto;
            margin-top: 0;
        }

        .send-report-button::before {
            content: '\f1d8';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            margin-left: 0.3rem;
        }

        .send-report-button.sent::before {
            content: '\f00c';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            margin-left: 0.3rem;
        }

        .sent-icon {
            color: #059669;
            margin-right: 0.3rem;
        }
    </style>
</head>
<body>
<header>
    Ø³Ø§Ù…Ø§Ù†Ù‡ Ø«Ø¨Øª Ú¯Ø²Ø§Ø±Ø´ ØªØ¯Ø±ÛŒØ³ - Ø¢Ú©Ø§Ø¯Ù…ÛŒ Ù‡ÙˆÙ¾â€ŒØ¨Ø±ÛŒØ¬
</header>
<main>
    <p class="teacher-id">Ú©Ø¯ Ø§Ø³ØªØ§Ø¯: <span id="teacherId">TCHR-003</span></p>

    <iframe src="plan.pdf" title="Ø¨Ø±Ù†Ø§Ù…Ù‡ ØªØ¯Ø±ÛŒØ³"></iframe>

    <form id="reportForm">
        <input type="hidden" name="teacher_id" id="formTeacherId" value="TCHR-003" />

        <label>Ø§Ù†ØªØ®Ø§Ø¨ ØµÙ†Ù:</label>
        <select id="class" name="class" required>
            <option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ ØµÙ†Ù --</option>
            <optgroup label="Ú©Ù…Ù¾ÛŒÙˆØªØ±">
                <option value="Ú©Ù…Ù¾ÛŒÙˆØªØ± A">Ú©Ù…Ù¾ÛŒÙˆØªØ± A</option>
                <option value="Ú©Ù…Ù¾ÛŒÙˆØªØ± B">Ú©Ù…Ù¾ÛŒÙˆØªØ± B</option>
                <option value="Ú©Ù…Ù¾ÛŒÙˆØªØ± C">Ú©Ù…Ù¾ÛŒÙˆØªØ± C</option>
            </optgroup>
            <optgroup label="Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ">
                <option value="Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ A">Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ A</option>
                <option value="Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ B">Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ B</option>
                <option value="Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ C">Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ C</option>
            </optgroup>
            <optgroup label="Ø¯ÛŒÚ¯Ø±">
                <option value="Ø¯ÛŒÚ¯Ø± A">Ø¯ÛŒÚ¯Ø± A</option>
                <option value="Ø¯ÛŒÚ¯Ø± B">Ø¯ÛŒÚ¯Ø± B</option>
                <option value="Ø¯ÛŒÚ¯Ø± C">Ø¯ÛŒÚ¯Ø± C</option>
            </optgroup>
        </select>

        <label>ØªØ§Ø±ÛŒØ®:</label>
        <input type="date" id="date" name="date" required />

        <label>Ù…ÙˆØ¶ÙˆØ¹ Ø¯Ø±Ø³:</label>
        <input type="text" id="subject" name="subject" required />

        <label>Ù…Ø¯Øª Ø²Ù…Ø§Ù† ØªØ¯Ø±ÛŒØ³:</label>
        <input type="text" id="duration" name="duration" required />

        <label>Ù…Ø­ØªÙˆØ§ÛŒ ØªØ¯Ø±ÛŒØ³â€ŒØ´Ø¯Ù‡:</label>
        <textarea id="content" name="content" required></textarea>

        <label>Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ø³Ø·Ø­ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ:</label>
        <textarea id="assessment" name="assessment" required></textarea>

        <label>Ù…Ø´Ú©Ù„Ø§Øª ÛŒØ§ Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§:</label>
        <textarea id="challenges" name="challenges"></textarea>

        <label>Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª Ø§Ø³ØªØ§Ø¯:</label>
        <textarea id="suggestions" name="suggestions"></textarea>

        <label>ÙˆØ¶Ø¹ÛŒØª Ø­Ø¶ÙˆØ±:</label>
        <select name="presence_level" id="presence" required>
            <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
            <option value="full">Ù‡Ù…Ù‡ Ø­Ø§Ø¶Ø± Ø¨ÙˆØ¯Ù†Ø¯</option>
            <option value="partial">Ø¨Ø±Ø®ÛŒ ØºØ§ÛŒØ¨ Ø¨ÙˆØ¯Ù†Ø¯</option>
            <option value="low">Ø­Ø¶ÙˆØ± Ø¨Ø³ÛŒØ§Ø± Ù¾Ø§ÛŒÛŒÙ†</option>
        </select>

        <label>ØªØ¹Ø¯Ø§Ø¯ Ø­Ø§Ø¶Ø± Ùˆ ØºØ§ÛŒØ¨:</label>
        <textarea id="attendance" name="attendance" required></textarea>

        <button type="submit">Ø°Ø®ÛŒØ±Ù‡ Ú¯Ø²Ø§Ø±Ø´</button>
    </form>

    <div id="reportDisplay">
        <h3>Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø«Ø¨Øªâ€ŒØ´Ø¯Ù‡</h3>
    </div>

    <div class="exam-panel">
        <h3>Ù†ØªØ§ÛŒØ¬ Ø§Ù…ØªØ­Ø§Ù†</h3>

        <div id="localExamResults"></div>

        <form id="addExamResultForm" class="add-exam-form">
            <label>Ù†Ø§Ù… Ø´Ø§Ú¯Ø±Ø¯:</label>
            <input type="text" id="studentName" required placeholder="Ù…Ø«Ù„Ø§: Ø§Ø­Ù…Ø¯ Ø±Ø­ÛŒÙ…ÛŒ" />

            <label>Ú©Ø¯ Ø´Ø§Ú¯Ø±Ø¯:</label>
            <input type="text" id="studentId" required placeholder="Ù…Ø«Ù„Ø§: STD-051" />

            <label>Ù†Ù…Ø±Ù‡:</label>
            <input type="number" id="studentScore" required min="0" max="100" placeholder="Ù…Ø«Ù„Ø§: 85" />

            <button type="submit">Ø§ÙØ²ÙˆØ¯Ù† Ù†Ù…Ø±Ù‡</button>
        </form>

        <form id="examForm" method="POST" style="margin-top:1rem;">
            <input type="hidden" name="teacher_id" value="TCHR-003" />
            <div id="examFormInputs"></div>
            <button type="submit" id="submitExamResults">Ø«Ø¨Øª Ù†ØªØ§ÛŒØ¬ Ø§Ù…ØªØ­Ø§Ù†</button>
        </form>
    </div>
</main>

<script>
const teacherId = 'TCHR-003';
document.getElementById('teacherId').textContent = teacherId;
document.getElementById('formTeacherId').value = teacherId;

const reportKey = `reports-${teacherId}`;
const examKey = `exam-results-${teacherId}`;

const reportForm = document.getElementById('reportForm');
const examForm = document.getElementById('examForm');
const examFormInputs = document.getElementById('examFormInputs');

reportForm.addEventListener('submit', function (e) {
    e.preventDefault();
    const report = {
        class: document.getElementById('class').value,
        date: document.getElementById('date').value,
        subject: document.getElementById('subject').value,
        duration: document.getElementById('duration').value,
        content: document.getElementById('content').value,
        assessment: document.getElementById('assessment').value,
        challenges: document.getElementById('challenges').value,
        suggestions: document.getElementById('suggestions').value,
        presence: document.getElementById('presence').value,
        attendance: document.getElementById('attendance').value,
        sent: false
    };
    const existingReports = JSON.parse(localStorage.getItem(reportKey)) || [];
    existingReports.push(report);
    localStorage.setItem(reportKey, JSON.stringify(existingReports));
    showReports(existingReports);
    reportForm.reset();
});

function showReports(reports) {
    const display = document.getElementById('reportDisplay');
    display.innerHTML = `
        <h3>Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø«Ø¨Øªâ€ŒØ´Ø¯Ù‡</h3>
    `;
    if (reports.length === 0) {
        display.innerHTML += '<p>Ú¯Ø²Ø§Ø±Ø´ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>';
    } else {
        reports.forEach((r, index) => {
            const div = document.createElement('div');
            div.className = 'report-entry';
            div.innerHTML = `
                <div class="report-entry-header">
                    <div class="subtitle">${r.date} - ${r.class} / ${r.subject}</div>
                    <div>
                        <button class="send-report-button ${r.sent ? 'sent' : ''}" data-index="${index}" ${r.sent ? 'disabled' : ''}>Ø§Ø±Ø³Ø§Ù„</button>
                        <button class="delete-report-button" data-index="${index}">Ø­Ø°Ù</button>
                    </div>
                </div>
                <p><strong>Ù…Ø¯Øª ØªØ¯Ø±ÛŒØ³:</strong> ${r.duration}</p>
                <p><strong>Ù…Ø­ØªÙˆØ§:</strong> ${r.content}</p>
                <p><strong>Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ:</strong> ${r.assessment}</p>
                <p><strong>Ù…Ø´Ú©Ù„Ø§Øª:</strong> ${r.challenges || 'Ù†Ø¯Ø§Ø±Ø¯'}</p>
                <p><strong>Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª:</strong> ${r.suggestions || 'Ù†Ø¯Ø§Ø±Ø¯'}</p>
                <p><strong>Ø­Ø¶ÙˆØ±:</strong> ${r.presence}</p>
                <p><strong>ØªØ¹Ø¯Ø§Ø¯ Ø­Ø§Ø¶Ø± Ùˆ ØºØ§ÛŒØ¨:</strong> ${r.attendance}</p>
            `;
            display.appendChild(div);
        });
    }

    document.querySelectorAll('.delete-report-button').forEach(button => {
        button.addEventListener('click', (e) => {
            const idx = e.target.getAttribute('data-index');
            deleteReport(idx);
        });
    });

    document.querySelectorAll('.send-report-button:not(.sent)').forEach(button => {
        button.addEventListener('click', (e) => {
            const idx = e.target.getAttribute('data-index');
            sendTeachingReportToTelegram(idx, e.target);
        });
    });
}

function deleteReport(index) {
    const reports = JSON.parse(localStorage.getItem(reportKey)) || [];
    reports.splice(index, 1);
    localStorage.setItem(reportKey, JSON.stringify(reports));
    showReports(reports);
}

function sendTeachingReportToTelegram(index, button) {
    const token = "7637224975:AAH7Al4buvRmfwW3LUZ-REvloF9rZgoAStU"; // Your Bot Token
    const chatId = "-1002886209903"; // Your Telegram Group Chat ID
    const reports = JSON.parse(localStorage.getItem(reportKey)) || [];
    const report = reports[index];

    if (!report) {
        alert('Ú¯Ø²Ø§Ø±Ø´ ÛŒØ§ÙØª Ù†Ø´Ø¯.');
        return;
    }

    // Construct a detailed message with report data
    const message = `
ğŸ“¨ Ú¯Ø²Ø§Ø±Ø´ Ø¬Ø¯ÛŒØ¯ ØªØ¯Ø±ÛŒØ³ Ø§Ø² Ø¢Ú©Ø§Ø¯Ù…ÛŒ Ù‡ÙˆÙ¾â€ŒØ¨Ø±ÛŒØ¬
ğŸ“‹ Ú©Ø¯ Ø§Ø³ØªØ§Ø¯: ${teacherId}
ğŸ“š ØµÙ†Ù: ${report.class}
ğŸ“… ØªØ§Ø±ÛŒØ®: ${report.date}
ğŸ“– Ù…ÙˆØ¶ÙˆØ¹: ${report.subject}
â° Ù…Ø¯Øª ØªØ¯Ø±ÛŒØ³: ${report.duration}
ğŸ“ Ù…Ø­ØªÙˆØ§: ${report.content}
âœ… Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ: ${report.assessment}
âš ï¸ Ù…Ø´Ú©Ù„Ø§Øª: ${report.challenges || 'Ù†Ø¯Ø§Ø±Ø¯'}
ğŸ’¡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª: ${report.suggestions || 'Ù†Ø¯Ø§Ø±Ø¯'}
ğŸ‘¥ Ø­Ø¶ÙˆØ±: ${report.presence}
ğŸ”¢ ØªØ¹Ø¯Ø§Ø¯ Ø­Ø§Ø¶Ø± Ùˆ ØºØ§ÛŒØ¨: ${report.attendance}
    `;

    const url = `https://api.telegram.org/bot${token}/sendMessage?chat_id=${chatId}&text=${encodeURIComponent(message)}`;

    fetch(url)
        .then(response => {
            if (response.ok) {
                reports[index].sent = true;
                localStorage.setItem(reportKey, JSON.stringify(reports));
                button.classList.add('sent');
                button.setAttribute('disabled', 'disabled');
                button.innerHTML = 'Ø§Ø±Ø³Ø§Ù„â€ŒØ´Ø¯Ù‡ <i class="fas fa-check"></i>';
                alert("âœ… Ú¯Ø²Ø§Ø±Ø´ ØªØ¯Ø±ÛŒØ³ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù… Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯!");
            } else {
                alert("âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ú¯Ø²Ø§Ø±Ø´ ØªØ¯Ø±ÛŒØ³ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù….");
            }
        })
        .catch(error => {
            alert("âš ï¸ Ø®Ø·Ø§: " + error);
        });
}

function sendExamResultsToTelegram(e) {
    e.preventDefault();
    const token = "7637224975:AAH7Al4buvRmfwW3LUZ-REvloF9rZgoAStU"; // Your Bot Token
    const chatId = "-1002886209903"; // Your Telegram Group Chat ID
    const exams = JSON.parse(localStorage.getItem(examKey)) || [];

    if (exams.length === 0) {
        alert('Ù‡ÛŒÚ† Ù†ØªÛŒØ¬Ù‡ Ø§Ù…ØªØ­Ø§Ù†ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.');
        return;
    }

    if (exams.every(exam => exam.sent)) {
        alert('Ù†ØªØ§ÛŒØ¬ Ø§Ù…ØªØ­Ø§Ù† Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯.');
        return;
    }

    // Construct a message with all exam results
    let examDetails = exams.map((exam, i) => `
${i + 1}. Ù†Ø§Ù… Ø´Ø§Ú¯Ø±Ø¯: ${exam.studentName}
   Ú©Ø¯ Ø´Ø§Ú¯Ø±Ø¯: ${exam.studentId}
   Ù†Ù…Ø±Ù‡: ${exam.score}
    `).join('\n');

    const message = `
ğŸ“ Ù†ØªØ§ÛŒØ¬ Ø§Ù…ØªØ­Ø§Ù† Ø§Ø² Ø¢Ú©Ø§Ø¯Ù…ÛŒ Ù‡ÙˆÙ¾â€ŒØ¨Ø±ÛŒØ¬
ğŸ“‹ Ú©Ø¯ Ø§Ø³ØªØ§Ø¯: ${teacherId}
ğŸ“… ØªØ§Ø±ÛŒØ® Ø§Ø±Ø³Ø§Ù„: ${new Date().toLocaleString('fa-IR')}
ğŸ“Š Ù†ØªØ§ÛŒØ¬:
${examDetails}
    `;

    const url = `https://api.telegram.org/bot${token}/sendMessage?chat_id=${chatId}&text=${encodeURIComponent(message)}`;

    fetch(url)
        .then(response => {
            if (response.ok) {
                // Mark all exam results as sent
                exams.forEach(exam => { exam.sent = true; });
                localStorage.setItem(examKey, JSON.stringify(exams));
                loadExamResults();
                alert("âœ… Ù†ØªØ§ÛŒØ¬ Ø§Ù…ØªØ­Ø§Ù† Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù… Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯!");
            } else {
                alert("âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù†ØªØ§ÛŒØ¬ Ø§Ù…ØªØ­Ø§Ù† Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù….");
            }
        })
        .catch(error => {
            alert("âš ï¸ Ø®Ø·Ø§: " + error);
        });
}

window.addEventListener('load', () => {
    const savedReports = JSON.parse(localStorage.getItem(reportKey));
    if (savedReports && savedReports.length > 0) {
        showReports(savedReports);
    } else {
        showReports([]);
    }
    loadExamResults();

    examForm.addEventListener('submit', sendExamResultsToTelegram);
});

const localExamResultsDiv = document.getElementById('localExamResults');
const addExamResultForm = document.getElementById('addExamResultForm');

function loadExamResults() {
    const exams = JSON.parse(localStorage.getItem(examKey)) || [];
    renderExamResults(exams);
    updateExamFormInputs(exams);
    // Disable submit button if all results are sent
    const submitButton = document.getElementById('submitExamResults');
    if (exams.length > 0 && exams.every(exam => exam.sent)) {
        submitButton.disabled = true;
        submitButton.classList.add('sent');
        submitButton.innerHTML = 'Ø§Ø±Ø³Ø§Ù„â€ŒØ´Ø¯Ù‡ <i class="fas fa-check"></i>';
    } else {
        submitButton.disabled = false;
        submitButton.classList.remove('sent');
        submitButton.innerHTML = 'Ø«Ø¨Øª Ù†ØªØ§ÛŒØ¬ Ø§Ù…ØªØ­Ø§Ù†';
    }
}

function renderExamResults(exams) {
    localExamResultsDiv.innerHTML = '';
    if (exams.length === 0) {
        localExamResultsDiv.innerHTML = '<p>Ù†ØªØ§ÛŒØ¬ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>';
        return;
    }
    exams.forEach((exam, index) => {
        const div = document.createElement('div');
        div.className = 'exam-entry';
        div.innerHTML = `
            <span>${exam.studentName} (${exam.studentId}) - Ù†Ù…Ø±Ù‡: ${exam.score} ${exam.sent ? '<i class="fas fa-check sent-icon"></i>' : ''}</span>
            <button data-index="${index}">Ø­Ø°Ù</button>
        `;
        localExamResultsDiv.appendChild(div);
    });

    localExamResultsDiv.querySelectorAll('button').forEach(button => {
        button.addEventListener('click', (e) => {
            const idx = e.target.getAttribute('data-index');
            deleteExamResult(idx);
        });
    });
}

function deleteExamResult(index) {
    const exams = JSON.parse(localStorage.getItem(examKey)) || [];
    exams.splice(index, 1);
    localStorage.setItem(examKey, JSON.stringify(exams));
    loadExamResults();
}

addExamResultForm.addEventListener('submit', function(e) {
    e.preventDefault();
    const studentName = document.getElementById('studentName').value.trim();
    const studentId = document.getElementById('studentId').value.trim();
    const score = document.getElementById('studentScore').value.trim();

    if (!studentName || !studentId || score === '') {
        alert('Ù„Ø·ÙØ§Ù‹ Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯.');
        return;
    }

    const exams = JSON.parse(localStorage.getItem(examKey)) || [];
    exams.push({ studentName, studentId, score, sent: false });
    localStorage.setItem(examKey, JSON.stringify(exams));
    addExamResultForm.reset();
    loadExamResults();
});

function updateExamFormInputs(exams) {
    examFormInputs.innerHTML = '';
    exams.forEach((exam, i) => {
        examFormInputs.innerHTML += `
            <input type="hidden" name="students[${i}][name]" value="${exam.studentName}" />
            <input type="hidden" name="students[${i}][id]" value="${exam.studentId}" />
            <input type="hidden" name="students[${i}][score]" value="${exam.score}" />
        `;
    });
}
</script>
</body>
</html>
